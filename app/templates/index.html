{% extends "base.html" %}

{% block content %}
<div class="sidebar panel">
  <div class="user-row">
    <div class="user-email">{{ g.current_user.email }}</div>
    <a class="pill-btn" href="{{ url_for('main.logout') }}">Logout</a>
  </div>
  <h2>Conversations</h2>
  <ul>
    {% for conv in conversations %}
    <li {% if conv.id==current_conversation.id %}class="active" {% endif %}>
      {{ conv.title }}
    </li>
    {% endfor %}
  </ul>

  <form method="post" action="{{ url_for('main.create_conversation') }}">
    <input type="text" name="title" placeholder="New conversation title">
    <button type="submit">Create</button>
  </form>

  {% include "_bots_sidebar.html" %}
</div>

<div class="chat panel">
  <div id="messages" hx-get="{{ url_for('main.messages_partial', conv_id=current_conversation.id) }}"
    hx-trigger="load, every 10s" hx-target="#messages" hx-swap="innerHTML">
    {% include "_messages.html" %}
  </div>

  <form id="message-form" action="{{ url_for('main.post_message') }}" method="post"
    hx-post="{{ url_for('main.post_message') }}" hx-target="#messages" hx-swap="innerHTML"
    hx-on="htmx:afterRequest: this.reset()">
    <input type="hidden" name="conversation_id" value="{{ current_conversation.id }}">
    <textarea name="content" rows="2" placeholder="Type a message"></textarea>
    <button type="submit">Send</button>
  </form>
</div>
{% endblock %}